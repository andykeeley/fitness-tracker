{% extends "base.html" %}

{% block title %}Log Run - Fitness Tracker{% endblock %}

{% block content %}
<div class="active-workout">
    <div class="workout-header-bar">
        <div class="workout-type-badge">üèÉ Run</div>
        <div class="workout-date">{{ workout.date }}</div>
    </div>

    <form method="POST" action="{{ url_for('update_run', workout_id=workout.id) }}" class="run-form">
        <div class="form-group">
            <label for="distance_km">Distance (km)</label>
            <input type="number" id="distance_km" name="distance_km" min="0" step="0.01"
                   placeholder="5.00" value="{{ workout.distance_km or '' }}">
        </div>

        <div class="form-group">
            <label for="duration_minutes">Duration (minutes)</label>
            <input type="number" id="duration_minutes" name="duration_minutes" min="0"
                   placeholder="30" value="{{ workout.duration_minutes or '' }}">
        </div>

        <div class="run-stats-preview" id="pacePreview">
            <!-- Pace will be calculated with JS -->
        </div>

        <div class="workout-actions">
            <form method="POST" action="{{ url_for('cancel_workout', workout_id=workout.id) }}" class="inline-form">
                <button type="button" class="btn btn-secondary" onclick="if(confirm('Cancel this run?')) this.closest('.workout-actions').querySelector('.cancel-form').submit()">Cancel</button>
            </form>
            <button type="submit" class="btn btn-primary btn-finish">Continue</button>
        </div>
    </form>

    <form method="POST" action="{{ url_for('cancel_workout', workout_id=workout.id) }}" class="cancel-form" style="display:none;"></form>
</div>

<script>
// Calculate and display pace
const distanceInput = document.getElementById('distance_km');
const durationInput = document.getElementById('duration_minutes');
const pacePreview = document.getElementById('pacePreview');

function updatePace() {
    const distance = parseFloat(distanceInput.value);
    const duration = parseFloat(durationInput.value);

    if (distance > 0 && duration > 0) {
        const paceMinPerKm = duration / distance;
        const paceMin = Math.floor(paceMinPerKm);
        const paceSec = Math.round((paceMinPerKm - paceMin) * 60);
        pacePreview.innerHTML = `<span class="pace-label">Pace:</span> <span class="pace-value">${paceMin}:${paceSec.toString().padStart(2, '0')} /km</span>`;
        pacePreview.style.display = 'block';
    } else {
        pacePreview.style.display = 'none';
    }
}

distanceInput.addEventListener('input', updatePace);
durationInput.addEventListener('input', updatePace);
updatePace();
</script>
{% endblock %}
